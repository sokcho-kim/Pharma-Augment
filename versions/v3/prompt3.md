목적

요양심사약제-후처리의 각 행(약제 단위)에서 임베딩 학습용 질문을 생성

대명사/간접지칭 0%

주 약제명 / 품명 / 둘 다의 사용 비율을 약제 단위로 강제 준수

1) 출력 스키마(엄격)

모델은 행마다 아래 JSON 객체 1개만 출력한다.

{
  "drug_id": "string",                 // clause_id 등 고유키
  "main_name": "string",               // 예: "Tacrolimus 제제"
  "brand_names": ["string", "..."],    // 예: ["프로그랍캅셀", "프로그랍주사"]
  "questions": [
    {"text": "문장", "name_usage": "MAIN|BRAND|BOTH", "category": "범위|요건|오프라벨|기간|전환|증빙|본인부담|대상군|절차"}
  ],
  "ratio": {
    "MAIN": 0.35, "BRAND": 0.35, "BOTH": 0.30
  }
}

2) 비율 규칙(약제 단위 강제)

MAIN(주 약제명만): 30–40%

BRAND(품명만): 30–40%

BOTH(주 약제명+품명 동시 표기): 20–30%

PRONOUN 금지: 0%

금지 표현(예시): 이 약제, 해당 약제, 이 약, 그 약제, 본 약제, 동 제제, 이 제제, 해당 제제, 이 제품, 해당 제품, 이것, 그것 등 지시어/대명사/간접지칭 전부

예외적 재분배:

브랜드가 0개면: MAIN 70–80%, BOTH 20–30% (BRAND 0%)

브랜드가 1개면: MAIN 35–45%, BRAND 30–40%, BOTH 20–30%

비율의 합은 항상 1.0, 각 범위 ±0.02 허용(생성 난수로 인한 편차)

3) 질문 품질 규칙

개방형(WH) 중심: 무엇/어떤/언제/어떻게/왜 … ?

1문항 1논점(기간/전환/증빙/오프라벨/본인부담/대상군/절차/범위/요건 중 택 1)

길이: 학습 15–70자(권장 20–60), 검증셋은 12–50자

외부 참조 금지: FDA/EMA/WHO/식약처/국가 비교 등 원문 밖 정보 유도 금지

모호어 금지: “자세히/전부/기타/등등/일반적으로/대체로/관행상/아마도”

표현 통일: 숫자·단위·괄호 표기 일관화(예: 3개월, 1회/일)

4) 카테고리 분산(태깅 필수)

아래 9개 중 최소 4개 이상을 균형 분산:

범위(스코프), 요건/기준, 오프라벨/허가범위, 기간/시점, 전환(경구↔주사),
증빙/서류, 본인부담/급여구분, 대상군(소아/중증/비혈연 등), 절차/프로세스

5) 생성 프롬프트(Claude Code → gpt-4o-mini 호출용)
[역할] 너는 의료 보험 임베딩 모델 학습용 질문 생성기다.

[입력]
- drug_id: {clause_id}
- main_name: {메인약제명}            # 예: "Tacrolimus 제제"
- brand_names: {브랜드명배열}        # 예: ["프로그랍캅셀","프로그랍주사"] (없으면 [])
- content: """{세부인정기준 및 방법 전문}"""

[목표]
- content에 근거한 질문만 생성하라. 외부 지식/추정 금지.
- 아래 비율로 이름 사용을 강제:
  MAIN(주 약제명만) 30–40%, BRAND(품명만) 30–40%, BOTH(둘 다) 20–30%.
  *브랜드 0개/1개일 때의 재분배 규칙을 따를 것.*
- 대명사/간접 지칭은 사용 금지(예: "이/그/해당/본/동 제제·약제·제품", "이것/그것").

[형식/품질]
- 개방형 WH 문형 위주(무엇/어떤/언제/어떻게/왜)
- 1문항 1논점, 길이 15–70자
- 모호어·외부기관 금지
- 카테고리 9종 중 최소 4종 이상을 분산 태깅

[출력 스키마(필수)]
{
  "drug_id": "...",
  "main_name": "...",
  "brand_names": ["..."],
  "questions": [
    {"text":"...", "name_usage":"MAIN|BRAND|BOTH", "category":"..."}
  ],
  "ratio": {"MAIN":0.xx,"BRAND":0.xx,"BOTH":0.xx}
}

[검증]
- 각 질문의 text에 대명사/간접지칭이 포함되면 그 질문을 삭제하고 재생성하라.
- ratio 범위를 벗어나면 일부 질문의 name_usage와 문구를 조정해 재균형하라.
- JSON 외 텍스트 출력 금지.

6) 사후검증(클로드 코드에서 무조건 돌릴 정규화/검사)
(A) 대명사 차단 정규식
PRONOUN_RE = r"(이|그|해당|본|동)\s?(약|약제|제제|제품)|이것|그것"
assert not re.search(PRONOUN_RE, text)

(B) 이름 사용 검증

name_usage == "MAIN": main_name 반드시 포함, brand_names 모두 미포함

name_usage == "BRAND": brand_names 중 하나 이상 반드시 포함, main_name 미포함

name_usage == "BOTH": main_name 포함 + brand_names 중 하나 이상 포함

(C) 비율 검증

실제 생성된 name_usage 비율을 계산 → 범위 미준수 시 자동 재샘플/치환

브랜드 0/1개 예외 분기 적용

(D) 품질 필터

길이 15–70자(검증셋은 12–50)

개방형(WH) 우선: 문두 무엇/어떤/언제/어떻게/왜 선호

쉼표·‘및’·‘/’가 2회 이상이면 다중 논점으로 판단 → 분리/폐기

7) Tacrolimus 예시(대명사 금지 적용)

MAIN:

“Tacrolimus 제제의 조혈모세포이식 급여 범위는 무엇인가요?”

“Tacrolimus 경구제에서 주사제로 전환할 때 인정 조건은 무엇인가요?”

BRAND:

“프로그랍캅셀의 만성 류마티스관절염 급여 인정 기준은 무엇인가요?”

“프로그랍주사의 조혈모세포이식 환자 인정 기간은 언제까지인가요?”

BOTH:

“Tacrolimus(프로그랍주사)의 사용이 허가 범위를 초과할 때 급여 인정 요건은 무엇인가요?”

“프로그랍캅셀(Tacrolimus)의 처방 시 필수 증빙 서류는 무엇인가요?”

주의: “이 면역억제제…”, “해당 약제…” 같은 문장은 전량 불허.

8) 평가 기준(임베딩 관점)

이름사용비율: MAIN 30–40, BRAND 30–40, BOTH 20–30 (예외 규칙 적용)

대명사 0%: PRONOUN_RE 통과율 100%

개방형/단일논점: 다중논점 비율 < 5%

길이 적합: 15–70자 적합률 > 95%

카테고리 균형: 9개 중 최소 4개 이상 등장, 편중 카테고리(>40%) 없음

유사도 중복: 의미 유사도 ≥0.9 항목 < 1%

9) 실패 처리(자동 재조정 로직)

대명사 검출 → 해당 문항 폐기 후 동일 name_usage로 재생성

비율 미스(예: BRAND 과다) → 과다 분을 다른 name_usage로 문구 치환해 재균형

길이 위반/다중논점 → 재작성 요청(“짧게/한 논점만”)

카테고리 편중 → 부족한 카테고리 우선 큐로 추가 생성

10) 실행 팁

seed 고정으로 재현성(예: 20250903)

질문 수: 학습셋은 약제당 12–18개, 검증셋은 3–7개

brand_names 전처리: ‘·’, ‘/’, ‘,’ 구분자 분리 + 공백 트림

한글/영문 병기 변형 추가 슬롯: “타크로리무스(Tacrolimus)”